<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>《心安工程》日报系统 - 健康检查</title>
  <link rel="stylesheet" href="css/cssGlobalStyle.css">
  <style>
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    table { border-collapse: collapse; margin: 20px auto; width: 90%; }
    th, td { border: 1px solid #333; padding: 8px 16px; text-align: left; }
    th { background-color: #FAFAFA; font-weight: bold; color: #2E7D32; }
    .success { color: green; font-weight: 500; }
    .error { color: red; font-weight: 500; }
    .page-title { text-align: center; color: #333; margin: 20px 0; padding-bottom: 10px; border-bottom: 1px solid #E0E0E0; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="page-title">《心安工程》日报系统 - 健康检查清单</h1>
    <table>
      <tr>
        <th>检查项</th>
        <th>状态</th>
        <th>说明</th>
      </tr>
      <tr>
        <td>generateLivePreview 函数</td>
        <td id="check-preview"></td>
        <td>预览功能核心，决定预览区是否正常渲染</td>
      </tr>
      <tr>
        <td>DAODEJING_81_CHAPTERS 数据</td>
        <td id="check-daodejing"></td>
        <td>道德经81章完整性，决定章节搜索功能是否生效</td>
      </tr>
      <tr>
        <td>extractHighlights 函数</td>
        <td id="check-highlights"></td>
        <td>提取亮点功能，决定能否自动填充践行亮点</td>
      </tr>
      <tr>
        <td>本地存储权限</td>
        <td id="check-storage"></td>
        <td>保存草稿所需，决定能否持久化表单数据</td>
      </tr>
      <tr>
        <td>核心交互 JS</td>
        <td id="check-interaction"></td>
        <td>jsFormInteraction.js 加载状态，决定表单联动是否正常</td>
      </tr>
    </table>
  </div>
  <script>
    window.onload = function() {
      // 1. 检查预览函数（核心预览功能）
      const previewStatus = document.getElementById('check-preview');
      previewStatus.className = typeof window.generateLivePreview === 'function' ? 'success' : 'error';
      previewStatus.innerText = typeof window.generateLivePreview === 'function' ? '正常' : '异常';
      
      // 2. 检查道德经81章数据完整性
      const daodejingStatus = document.getElementById('check-daodejing');
      const daodejingValid = window.DAODEJING_81_CHAPTERS?.length === 81;
      daodejingStatus.className = daodejingValid ? 'success' : 'error';
      daodejingStatus.innerText = daodejingValid ? '正常（81章）' : `异常（当前${window.DAODEJING_81_CHAPTERS?.length || 0}章）`;
      
      // 3. 检查提取亮点函数
      const highlightsStatus = document.getElementById('check-highlights');
      highlightsStatus.className = typeof window.extractHighlights === 'function' ? 'success' : 'error';
      highlightsStatus.innerText = typeof window.extractHighlights === 'function' ? '正常' : '异常';
      
      // 4. 检查本地存储权限（草稿保存依赖）
      const storageStatus = document.getElementById('check-storage');
      try {
        localStorage.setItem('health-check', 'test');
        localStorage.removeItem('health-check');
        storageStatus.className = 'success';
        storageStatus.innerText = '正常';
      } catch (e) {
        storageStatus.className = 'error';
        storageStatus.innerText = '异常（无本地存储权限）';
      }
      
      // 5. 检查核心交互JS（表单联动依赖）
      const interactionStatus = document.getElementById('check-interaction');
      interactionStatus.className = typeof window.syncFormData === 'function' ? 'success' : 'error';
      interactionStatus.innerText = typeof window.syncFormData === 'function' ? '正常' : '异常';
      
      console.log('✅ 健康检查执行完成，详情见页面表格');
    };
  </script>
  <!-- 引入核心依赖JS，确保检查功能生效 -->
  <script src="js/xinan_emergency.js"></script>
  <script src="js/jsFormInteraction.js"></script>
  <script src="js/jsguidanceEngine.js"></script>
</body>
</html>