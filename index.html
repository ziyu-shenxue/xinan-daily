<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中华圣学修身《心安工程》日报系统</title>
    <!-- 外部依赖CDN（修复失效链接） -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <!-- 本地样式文件（修复路径错误） -->
    <link rel="stylesheet" href="cssprint全局样式文件.css">
</head>
<body>
    <!-- 顶部导航区（固定置顶） -->
    <header class="header-nav">
        <h1>中华圣学修身《心安工程》日报系统</h1>
        <div class="nav-buttons">
            <button class="btn btn-primary" onclick="saveDraft()">💾 保存草稿</button>
            <button class="btn btn-secondary" onclick="document.querySelector('.preview-container').classList.toggle('hidden')">👁️ 预览日报</button>
            <button class="btn btn-secondary" onclick="exportPDF()">📄 导出PDF</button>
            <button class="btn btn-secondary" onclick="exportPNG()">🖼️ 导出图片</button>
            <button class="btn btn-primary" onclick="submitSync()">✅ 提交同步</button>
            <button class="btn btn-secondary" id="voiceToggle" onclick="toggleVoiceInput()">🎤 语音输入</button>
            <button class="btn btn-secondary" onclick="alert('帮助指南：\n1. 红框标注为核心必填项\n2. 章节选择支持关键词搜索\n3. 数据自动实时同步预览区\n4. 草稿自动保存，刷新不丢失')">❓ 帮助</button>
            <button class="btn btn-secondary" onclick="loadHistory()">⏱️ 历史记录</button>
        </div>
    </header>

    <!-- 主体内容区（双列布局） -->
    <div class="main-container">
        <!-- 左侧填写区 -->
        <div class="form-container">
            <!-- 模块1：基础信息（必填） -->
            <section class="module-section" id="module1">
                <div class="module-header">
                    <h2>一、基础信息 <span class="module-complete" id="module1-complete"></span></h2>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="date">日期</label>
                    <input type="date" class="input-field core-component" id="date" placeholder="YYYY-MM-DD">
                    <p class="form-hint">自动生成当前日期，支持日历选择或手动输入</p>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="weekday">星期</label>
                    <input type="text" class="input-field core-component" id="weekday" readonly placeholder="星期一">
                    <p class="form-hint">随日期自动生成，无需手动修改</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="report_id">日报编号</label>
                    <input type="text" class="input-field" id="report_id" readonly placeholder="自动生成唯一编号">
                    <p class="form-hint">格式：年份后两位+月份+日期+3位序号（如251229001）</p>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="core_direction">核心修习方向（可多选）</label>
                    <select class="input-field core-component" id="core_direction" multiple onchange="updateDirectionTags()">
                        <option value="圣学心传">圣学心传</option>
                        <option value="圣学心践">圣学心践</option>
                        <option value="道德经五维">道德经五维</option>
                    </select>
                    <div class="tags-container" id="direction_tags"></div>
                    <p class="form-hint">选择后自动展开对应模块，支持多选</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="weather">天气/环境备注</label>
                    <input type="text" class="input-field core-component" id="weather" placeholder="例：晴/居家修习、雨/书房静心" 
       autocomplete="off" maxlength="50">
<p class="form-hint">预设选项：晴/阴/雨/雪 + 居家/书房/户外/办公，支持自定义输入（最多50字）</p>
                </div>
            </section>

            <!-- 模块2：《中华圣学心传》先天智慧体悟 -->
            <section class="module-section" id="module2">
                <div class="module-header">
                    <h2>二、《中华圣学心传》先天智慧体悟 <span class="module-complete" id="module2-complete"></span></h2>
                </div>
                <div class="form-group">
                    <label class="form-label" for="xinchuan_proverb">今日箴言</label>
                    <div style="display: flex; gap: 8px;">
                        <textarea class="input-field core-component" id="xinchuan_proverb" placeholder="本心流露或原文摘录（例：万物衍化本清静）" 
          autocomplete="off" rows="3" maxlength="200"></textarea>
<button class="voice-btn core-component" onclick="startVoice('xinchuan_proverb')" id="voice-btn-proverb">
  🎤 <span class="voice-status">语音输入</span>
</button>
</div>
<div id="preview-loading" style="display: none; color: #666;">预览更新中...</div>
<p class="form-hint">支持手动输入/粘贴/语音转文字，建议引用典籍原文（最多200字）
  <span id="xinchuan_proverb-count">0/200</span>
</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="xinchuan_scene">日常应用场景</label>
                    <textarea class="input-field core-component" id="xinchuan_scene" placeholder="具体场景+践行动作（例：同事争执时，践行'不争'箴言，主动退让）"></textarea>
                    <p class="form-hint emphasis">最少输入10字，描述箴言在实际生活中的应用过程</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="xinchuan_eight">八维定位（单选）</label>
                    <select class="input-field core-component" id="xinchuan_eight">
                        <option value="">请选择</option>
                        <option value="道维-破妄见真">道维-破妄见真</option>
                        <option value="德维-积德显真">德维-积德显真</option>
                        <option value="仁维-仁爱显真">仁维-仁爱显真</option>
                        <option value="义维-义行守真">义维-义行守真</option>
                        <option value="礼维-礼序安真">礼维-礼序安真</option>
                        <option value="智维-明智辨真">智维-明智辨真</option>
                        <option value="信维-诚信归真">信维-诚信归真</option>
                        <option value="融维-圆融通真">融维-圆融通真</option>
                    </select>
                    <p class="form-hint">选择箴言对应的核心维度，助力精准定位修习方向</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="xinchuan_six">六序进度（可多选）</label>
                    <select class="input-field core-component" id="xinchuan_six" multiple onchange="updateSixTags()">
                        <option value="惊觉">惊觉</option>
                        <option value="领悟">领悟</option>
                        <option value="透视">透视</option>
                        <option value="认取">认取</option>
                        <option value="担当">担当</option>
                        <option value="践行">践行</option>
                    </select>
                    <div class="tags-container" id="six_tags"></div>
                    <p class="form-hint">可选择多个当前进度阶段，支持动态调整</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="xinchuan_energy">能量感知</label>
                    <div class="range-container">
                        <input type="range" class="range-field core-component" id="xinchuan_energy_range" min="1" max="10" value="5" data-link="xinchuan_energy_value">
                        <input type="number" class="input-field range-value core-component" id="xinchuan_energy_value" min="1" max="10" value="5" data-link="xinchuan_energy_range">
                    </div>
                    <p class="form-hint emphasis" id="energy-hint">5分=状态中等 | 实时反馈当前能量状态</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="xinchuan_wangnian">妄念类型</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select class="input-field core-component" id="xinchuan_wangnian" onchange="toggleOtherWangnian()">
                            <option value="">请选择</option>
                            <option value="求认可">求认可</option>
                            <option value="贪速成">贪速成</option>
                            <option value="攀比心">攀比心</option>
                            <option value="嗔怒心">嗔怒心</option>
                            <option value="懈怠心">懈怠心</option>
                            <option value="其他">其他</option>
                        </select>
                        <input type="text" class="input-field core-component" id="xinchuan_wangnian_other" placeholder="请输入" style="display: none;">
                    </div>
                    <p class="form-hint">选择今日主要妄念类型，助力针对性格除</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="xinchuan_count">格除次数</label>
                    <input type="number" class="input-field core-component" id="xinchuan_count" min="0" max="99" value="0">
                    <p class="form-hint">记录今日成功格除妄念的次数，默认0次</p>
                </div>
            </section>

            <!-- 模块3：《中华圣学心践论》十目践行记录 -->
            <section class="module-section" id="module3">
                <div class="module-header">
                    <h2>三、《中华圣学心践论》十目践行记录 <span class="module-complete" id="module3-complete"></span></h2>
                </div>
                <div class="ten-items-grid">
                    <!-- 十目践行项目（2列5行） -->
                    <div class="ten-item-container">
                        <label class="form-label">1. 格念</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_1" value="践行" id="xinjian_1_1" class="core-component">
                                <label for="xinjian_1_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_1" value="未践行" id="xinjian_1_2" class="core-component">
                                <label for="xinjian_1_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_1" value="部分践行" id="xinjian_1_3" class="core-component" onchange="toggleRemark(1)">
                                <label for="xinjian_1_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_1" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">2. 正心</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_2" value="践行" id="xinjian_2_1" class="core-component">
                                <label for="xinjian_2_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_2" value="未践行" id="xinjian_2_2" class="core-component">
                                <label for="xinjian_2_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_2" value="部分践行" id="xinjian_2_3" class="core-component" onchange="toggleRemark(2)">
                                <label for="xinjian_2_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_2" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">3. 修身</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_3" value="践行" id="xinjian_3_1" class="core-component">
                                <label for="xinjian_3_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_3" value="未践行" id="xinjian_3_2" class="core-component">
                                <label for="xinjian_3_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_3" value="部分践行" id="xinjian_3_3" class="core-component" onchange="toggleRemark(3)">
                                <label for="xinjian_3_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_3" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">4. 处事</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_4" value="践行" id="xinjian_4_1" class="core-component">
                                <label for="xinjian_4_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_4" value="未践行" id="xinjian_4_2" class="core-component">
                                <label for="xinjian_4_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_4" value="部分践行" id="xinjian_4_3" class="core-component" onchange="toggleRemark(4)">
                                <label for="xinjian_4_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_4" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">5. 接物</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_5" value="践行" id="xinjian_5_1" class="core-component">
                                <label for="xinjian_5_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_5" value="未践行" id="xinjian_5_2" class="core-component">
                                <label for="xinjian_5_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_5" value="部分践行" id="xinjian_5_3" class="core-component" onchange="toggleRemark(5)">
                                <label for="xinjian_5_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_5" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">6. 齐家</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_6" value="践行" id="xinjian_6_1" class="core-component">
                                <label for="xinjian_6_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_6" value="未践行" id="xinjian_6_2" class="core-component">
                                <label for="xinjian_6_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_6" value="部分践行" id="xinjian_6_3" class="core-component" onchange="toggleRemark(6)">
                                <label for="xinjian_6_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_6" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">7. 济世</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_7" value="践行" id="xinjian_7_1" class="core-component">
                                <label for="xinjian_7_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_7" value="未践行" id="xinjian_7_2" class="core-component">
                                <label for="xinjian_7_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_7" value="部分践行" id="xinjian_7_3" class="core-component" onchange="toggleRemark(7)">
                                <label for="xinjian_7_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_7" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">8. 一贯</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_8" value="践行" id="xinjian_8_1" class="core-component">
                                <label for="xinjian_8_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_8" value="未践行" id="xinjian_8_2" class="core-component">
                                <label for="xinjian_8_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_8" value="部分践行" id="xinjian_8_3" class="core-component" onchange="toggleRemark(8)">
                                <label for="xinjian_8_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_8" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">9. 成性</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_9" value="践行" id="xinjian_9_1" class="core-component">
                                <label for="xinjian_9_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_9" value="未践行" id="xinjian_9_2" class="core-component">
                                <label for="xinjian_9_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_9" value="部分践行" id="xinjian_9_3" class="core-component" onchange="toggleRemark(9)">
                                <label for="xinjian_9_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_9" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                    <div class="ten-item-container">
                        <label class="form-label">10. 化民</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="xinjian_10" value="践行" id="xinjian_10_1" class="core-component">
                                <label for="xinjian_10_1">践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_10" value="未践行" id="xinjian_10_2" class="core-component">
                                <label for="xinjian_10_2">未践行</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="xinjian_10" value="部分践行" id="xinjian_10_3" class="core-component" onchange="toggleRemark(10)">
                                <label for="xinjian_10_3">部分践行</label>
                            </div>
                        </div>
                        <input type="text" class="input-field remark-input core-component" id="remark_10" placeholder="例：3次成功2次遗漏" style="display: none;">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label class="form-label" for="weld_density">焊缝能量密度</label>
                    <div class="range-container">
                        <input type="range" class="range-field core-component" id="weld_density_range" min="1" max="10" value="5" data-link="weld_density_value">
                        <input type="number" class="input-field range-value core-component" id="weld_density_value" min="1" max="10" value="5" data-link="weld_density_range">
                    </div>
                    <p class="form-hint emphasis" id="density-hint">5分=中等密度，实时同步十目践行完成率</p>
                </div>
            </section>

            <!-- 模块4：《道德经・五维生命智慧体系探索》 -->
            <section class="module-section collapsed" id="module4">
                <div class="module-header">
                    <h2>四、《道德经・五维生命智慧体系探索》 <span class="module-complete" id="module4-complete"></span></h2>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="daodejing_chapter">对应书籍章节（搜索式选择）</label>
                    <div class="search-select-container core-component">
                        <input type="text" class="input-field search-input" id="chapter_search" placeholder="输入关键词搜索（如：焦虑、攀比、孤独）" oninput="searchChapter()">
                        <div class="search-results" id="chapter_results"></div>
                    </div>
                    <input type="hidden" id="daodejing_chapter" value="">
                    <p class="form-hint emphasis" id="chapter-hint">请选择对应困惑章节，支持关键词快速搜索（如输入"焦虑"匹配相关章节）</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="wuwei_zhishen_time">治神时长（分钟）</label>
                    <input type="number" class="input-field core-component" id="wuwei_zhishen_time" min="0" step="0.5" placeholder="对应章节核心修习-治神时长（例：15.5）">
                    <p class="form-hint emphasis" id="zhishen-hint">支持小数点（例：15.5） | 选择章节后显示重点提示</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="wuwei_hrv">HRV数值（ms²）</label>
                    <input type="number" class="input-field core-component" id="wuwei_hrv" min="0" placeholder="生理监测数据（无则留空，对应章节能量涵养指标）">
                    <p class="form-hint">可选填，治神篇章节修习的能量状态参考指标</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="wuwei_shenju">神聚度</label>
                    <div class="range-container">
                        <input type="range" class="range-field core-component" id="shenju_range" min="1" max="10" value="5" data-link="shenju_value">
                        <input type="number" class="input-field range-value core-component" id="shenju_value" min="1" max="10" value="5" data-link="shenju_range">
                    </div>
                    <p class="form-hint emphasis" id="shenju-hint">5分=中等聚度，选择章节后显示核心修习目标</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="wuwei_emotion">情绪稳定度</label>
                    <div class="range-container">
                        <input type="range" class="range-field core-component" id="emotion_range" min="1" max="10" value="5" data-link="emotion_value">
                        <input type="number" class="input-field range-value core-component" id="emotion_value" min="1" max="10" value="5" data-link="emotion_range">
                    </div>
                    <p class="form-hint emphasis" id="emotion-hint">10分=满分稳定 | 选择章节后显示情志调和重点</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="wuwei_sleep">睡眠时长（小时）</label>
                    <input type="number" class="input-field core-component" id="wuwei_sleep" min="0" step="0.5" placeholder="对应章节治身篇-作息涵养数据（例：7.5）">
                    <p class="form-hint">支持0.5步长，治身篇章节修习的基础保障指标</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="wuwei_interaction">互动满意度</label>
                    <div class="range-container">
                        <input type="range" class="range-field core-component" id="interaction_range" min="1" max="10" value="5" data-link="interaction_value">
                        <input type="number" class="input-field range-value core-component" id="interaction_value" min="1" max="10" value="5" data-link="interaction_range">
                    </div>
                    <p class="form-hint emphasis">10分=满分满意 | 对应章节治世篇-人际践行效果</p>
                </div>
            </section>

            <!-- 模块5：总结与明日规划 -->
            <section class="module-section" id="module5">
                <div class="module-header">
                    <h2>五、总结与明日规划 <span class="module-complete" id="module5-complete"></span></h2>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="summary_feeling">今日核心感悟</label>
                    <div style="display: flex; gap: 8px;">
                        <textarea class="input-field core-component" id="summary_feeling" placeholder="元认知反思（例：不争并非消极，而是内心清静的自然流露/修习第3章后，攀比焦虑明显缓解）"></textarea>
                        <button class="voice-btn core-component" onclick="startVoice('summary_feeling')">🎤</button>
                    </div>
                    <p class="form-hint emphasis">最少输入15字，结合典籍修习与实际生活的深度反思</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="summary_highlight">数据亮点</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="text" class="input-field core-component" id="summary_highlight" placeholder="量化数据/践行成果（例：心践十目践行率90%/治神时长达标20分钟）">
                        <button class="btn btn-secondary" onclick="extractHighlights()">提取亮点</button>
                    </div>
                    <p class="form-hint">点击"提取亮点"按钮，系统自动从填写数据中筛选达标项</p>
                </div>
                <div class="form-group" style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <label class="form-label" for="tomorrow_xinchuan">明日重点-圣学心传</label>
                        <select class="input-field core-component" id="tomorrow_xinchuan">
                            <option value="">请选择</option>
                            <option value="道维-破妄见真">道维-破妄见真</option>
                            <option value="德维-积德显真">德维-积德显真</option>
                            <option value="仁维-仁爱显真">仁维-仁爱显真</option>
                            <option value="义维-义行守真">义维-义行守真</option>
                            <option value="礼维-礼序安真">礼维-礼序安真</option>
                            <option value="智维-明智辨真">智维-明智辨真</option>
                            <option value="信维-诚信归真">信维-诚信归真</option>
                            <option value="融维-圆融通真">融维-圆融通真</option>
                        </select>
                    </div>
                    <div style="flex: 1; min-width: 250px;">
                        <label class="form-label" for="tomorrow_xinjian">明日重点-圣学心践</label>
                        <select class="input-field core-component" id="tomorrow_xinjian">
                            <option value="">请选择</option>
                            <option value="格念">格念</option>
                            <option value="正心">正心</option>
                            <option value="修身">修身</option>
                            <option value="处事">处事</option>
                            <option value="接物">接物</option>
                            <option value="齐家">齐家</option>
                            <option value="济世">济世</option>
                            <option value="一贯">一贯</option>
                            <option value="成性">成性</option>
                            <option value="化民">化民</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="tomorrow_wuwei">明日重点-五维</label>
                    <select class="input-field core-component" id="tomorrow_wuwei">
                        <option value="">请选择</option>
                        <option value="治神篇重点">治神篇重点</option>
                        <option value="治心篇重点">治心篇重点</option>
                        <option value="治身篇重点">治身篇重点</option>
                        <option value="治性篇重点">治性篇重点</option>
                        <option value="治世篇重点">治世篇重点</option>
                    </select>
                                       <p class="form-hint">选择明日五维修习的核心篇章方向</p>
                </div>
            </section>
        </div>

        <!-- 右侧实时预览区（根目录适配，增加加载状态） -->
        <div class="preview-container" style="padding: 15px; box-sizing: border-box;">
            <h2 style="text-align: center; margin-bottom: 15px; color: #2E7D32; font-size: 18px;">日报实时预览</h2>
            <!-- 加载状态提示（关联JS的预览更新逻辑） -->
            <div id="preview-loading" style="display: none; text-align: center; padding: 20px 0; color: #666;">
                预览生成中...
            </div>
            <div id="live_preview" class="preview-report" style="min-height: 300px; border: 1px solid #eee; padding: 15px; border-radius: 4px;">
                <!-- 预览内容由根目录的jsreportGenerator.js实时生成 -->
                <div style="text-align: center; padding: 50px 0; color: #666; font-size: 14px;">
                    填写左侧内容，实时同步预览...<br>
                    <small style="color: #999; margin-top: 8px; display: block;">提示：所有JS文件需放在根目录以确保功能正常</small>
                </div>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 15px; padding: 8px 0; border: none; border-radius: 4px; background: #e0e0e0; cursor: pointer;" onclick="window.print()">🖨️ 打印预览</button>
        </div>
    </div>

    <!-- 底部操作区（固定置底，根目录样式适配） -->
    <footer class="footer-actions" style="position: fixed; bottom: 0; left: 0; right: 0; background: #fff; padding: 10px 15px; border-top: 1px solid #eee; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; z-index: 999;">
        <button class="btn btn-secondary" style="padding: 8px 12px; border: none; border-radius: 4px; background: #e0e0e0; cursor: pointer;" onclick="resetForm()">🔄 清空重填</button>
        <button class="btn btn-primary" style="padding: 8px 12px; border: none; border-radius: 4px; background: #2E7D32; color: #fff; cursor: pointer;" onclick="saveDraft()">💾 保存草稿</button>
        <button class="btn btn-secondary" style="padding: 8px 12px; border: none; border-radius: 4px; background: #e0e0e0; cursor: pointer;" onclick="exportJSON()">📊 导出JSON数据</button>
        <button class="btn btn-secondary" style="padding: 8px 12px; border: none; border-radius: 4px; background: #e0e0e0; cursor: pointer;" onclick="exportPDF()">📄 导出PDF</button>
        <button class="btn btn-secondary" style="padding: 8px 12px; border: none; border-radius: 4px; background: #e0e0e0; cursor: pointer;" onclick="exportPNG()">🖼️ 导出图片</button>
        <button class="btn btn-primary" style="padding: 8px 12px; border: none; border-radius: 4px; background: #2E7D32; color: #fff; cursor: pointer;" onclick="submitSync()">✅ 提交同步</button>
    </footer>

<style>
  /* 现有样式 */
  .form-group {
    margin-bottom: 16px;
  }
  .input-field {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  
  /* 新增样式 */
  .module-complete-active {
    color: #2ecc71; /* 绿色对勾，可适配主题变量 */
    font-size: 1.2em;
    font-weight: bold;
  }
</style>

    <!-- 本地脚本文件（按依赖顺序引入） -->
    <script src="js/interactive/datePicker.js"></script>
    <script src="js/interactive/sliderNumberLink.js"></script>
    <script src="js/interactive/daodejingFiveDimension.js"></script>
    <script src="js/interactive/index.js"></script>
    <script src="jsrecognition.js"></script>
    <script src="jsguidanceEngine.js"></script>
    <script src="jsreportGenerator.js"></script>

    <!-- 页面初始化脚本 -->
    <script>
        // 初始化日报编号
        function initReportId() {
            const prefix = REPORT_CONFIG.REPORT_ID_PREFIX();
            const reports = JSON.parse(localStorage.getItem(REPORT_CONFIG.STORAGE_KEY) || '[]');
            const todayReports = reports.filter(report => report.report_id.startsWith(prefix));
            const serialNumber = String(todayReports.length + 1).padStart(3, '0');
            document.getElementById('report_id').value = `${prefix}${serialNumber}`;
        }

        // 切换部分践行备注输入框显示
        function toggleRemark(index) {
            const remarkInput = document.getElementById(`remark_${index}`);
            const isPartially = document.querySelector(`input[name="xinjian_${index}"][value="部分践行"]`).checked;
            remarkInput.style.display = isPartially ? 'block' : 'none';
            if (!isPartially) remarkInput.value = '';
            updateWeldDensity();
        }

        // 更新核心修习方向标签
        function updateDirectionTags() {
            const select = document.getElementById('core_direction');
            const tagsContainer = document.getElementById('direction_tags');
            const selectedOptions = Array.from(select.selectedOptions).map(o => o.value);
            
            // 生成标签
            tagsContainer.innerHTML = '';
            selectedOptions.forEach(option => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                if (option === '圣学心传') tag.classList.add('xinchuan');
                if (option === '圣学心践') tag.classList.add('xinjian');
                if (option === '道德经五维') tag.classList.add('wuwei');
                tag.textContent = option;
                tagsContainer.appendChild(tag);
            });

            // 联动模块4显示/隐藏
            const module4 = document.getElementById('module4');
            if (selectedOptions.includes('道德经五维')) {
                module4.classList.remove('collapsed');
            } else {
                module4.classList.add('collapsed');
            }
        }

        // 更新六序进度标签
        function updateSixTags() {
            const select = document.getElementById('xinchuan_six');
            const tagsContainer = document.getElementById('six_tags');
            const selectedOptions = Array.from(select.selectedOptions).map(o => o.value);
            
            // 生成标签
            tagsContainer.innerHTML = '';
            selectedOptions.forEach(option => {
                const tag = document.createElement('span');
                tag.className = 'tag xinchuan';
                tag.textContent = option;
                tagsContainer.appendChild(tag);
            });
        }

        // 切换其他妄念输入框
        function toggleOtherWangnian() {
            const select = document.getElementById('xinchuan_wangnian');
            const otherInput = document.getElementById('xinchuan_wangnian_other');
            otherInput.style.display = select.value === '其他' ? 'inline-block' : 'none';
            if (select.value !== '其他') otherInput.value = '';
        }

        // 提取数据亮点
        function extractHighlights() {
            const formData = collectFormData();
            const highlights = [];

            // 提取心传亮点
            if (formData.xinchuan_energy >= 8) highlights.push(`心传能量感知${formData.xinchuan_energy}分（优秀）`);
            if (formData.xinchuan_count > 0) highlights.push(`格除妄念${formData.xinchuan_count}次`);

            // 提取心践亮点
            if (formData.xinjian_completion_rate >= 90) highlights.push(`心践十目践行率${formData.xinjian_completion_rate}%（优秀）`);
            if (formData.weld_density >= 8) highlights.push(`焊缝能量密度${formData.weld_density}分（优秀）`);

            // 提取五维亮点
            if (formData.wuwei_shenju >= 8) highlights.push(`神聚度${formData.wuwei_shenju}分（优秀）`);
            if (formData.wuwei_emotion >= 8) highlights.push(`情绪稳定度${formData.wuwei_emotion}分（优秀）`);
            if (formData.wuwei_zhishen_time && formData.wuwei_zhishen_time >= 20) highlights.push(`治神时长达标${formData.wuwei_zhishen_time}分钟`);

            // 填充亮点
            document.getElementById('summary_highlight').value = highlights.join('、');
        }

        // 重置表单
        function resetForm() {
            if (confirm('确定要清空所有填写内容吗？已保存的草稿不会丢失。')) {
                // 保留基础信息（日期、星期、编号、天气）
                const date = document.getElementById('date').value;
                const weekday = document.getElementById('weekday').value;
                const reportId = document.getElementById('report_id').value;
                const weather = document.getElementById('weather').value;
                const coreDirection = document.getElementById('core_direction').value;

                // 重置所有表单元素
                document.querySelectorAll('input, textarea, select').forEach(el => {
                    if (el.id === 'date') el.value = date;
                    else if (el.id === 'weekday') el.value = weekday;
                    else if (el.id === 'report_id') el.value = reportId;
                    else if (el.id === 'weather') el.value = weather;
                    else if (el.id === 'core_direction') return; // 保留核心修习方向
                    else if (el.type === 'radio') el.checked = false;
                    else if (el.type === 'checkbox') el.checked = false;
                    else el.value = '';
                });

                // 重置滑块
                document.querySelectorAll('.range-field').forEach(slider => {
                    const defaultValue = slider.value = 5;
                    const linkId = slider.dataset.link;
                    if (linkId) document.getElementById(linkId).value = defaultValue;
                    slider.style.setProperty('--value', '50%');
                });

                // 重置标签和备注
                document.getElementById('six_tags').innerHTML = '';
                document.querySelectorAll('.remark-input').forEach(input => {
                    input.style.display = 'none';
                    input.value = '';
                });

                // 重新生成预览
                generateLivePreview();
                showExportHint('✅ 表单已清空，基础信息已保留');
            }
        }

        // 加载历史记录
        function loadHistory() {
            const reports = JSON.parse(localStorage.getItem(REPORT_CONFIG.STORAGE_KEY) || '[]');
            if (reports.length === 0) {
                alert('暂无历史草稿记录');
                return;
            }

            let historyHtml = '<div style="max-height: 400px; overflow-y: auto; padding: 10px;">';
                        reports.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((report, index) => {
                historyHtml += `
                    <div style="padding: 8px; border-bottom: 1px solid #E0E0E0; cursor: pointer;" onclick="loadSpecificReport('${report.report_id}')">
                        <div style="font-weight: bold; color: #1976D2;">${report.report_id}</div>
                        <div style="font-size: 12px; color: #666;">日期：${report.date} ${report.weekday}</div>
                        <div style="font-size: 12px; color: #666;">方向：${report.core_direction || '未选择'}</div>
                    </div>
                `;
            });
            historyHtml += '</div>';

            alert(historyHtml);
        }

        // 加载指定历史报告
        function loadSpecificReport(reportId) {
            const reports = JSON.parse(localStorage.getItem(REPORT_CONFIG.STORAGE_KEY) || '[]');
            const report = reports.find(r => r.report_id === reportId);
            if (!report) {
                alert('未找到该报告');
                return;
            }

            if (confirm(`确定要加载报告 ${report.report_id}（${report.date}）吗？当前填写内容将被覆盖。`)) {
                // 清空当前表单并加载报告数据（复用loadDraft逻辑）
                loadDraft(report);
                showExportHint(`✅ 已加载历史报告：${report.report_id}`);

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', () => {
            initReportId();
            initChapterDataBatch2(); // 加载第2批次章节数据
            initChapterDataBatch3(); // 加载第3批次章节数据（后续补充）
            updateDirectionTags();
            updateSixTags();
            console.log('✅ 主页面初始化完成，所有功能模块已就绪');
        });
    <script>
      // 原有函数（startVoice/updateDirectionTags等）
      function updateDirectionTags() {
        // 原有逻辑
      }
      
      function startVoice(targetId) {
        // 原有逻辑
      }

      // 新增：监听箴言输入长度
      document.getElementById('xinchuan_proverb').addEventListener('input', function() {
        const count = this.value.length;
        document.getElementById('xinchuan_proverb-count').textContent = `${count}/200`;
        if (count > 200) {
          document.getElementById('xinchuan_proverb-count').style.color = '#e74c3c';
        } else {
          document.getElementById('xinchuan_proverb-count').style.color = '#666';
        }
      });

      // 新增：语音按钮状态切换（合并到现有startVoice）
      // 若原有startVoice无内容，直接替换；若有，仅合并状态切换逻辑
      function startVoice(targetId) {
        // 【保留原有startVoice逻辑】
        
        // 新增状态切换逻辑
        const voiceBtn = document.getElementById(`voice-btn-${targetId.split('_')[1]}`);
        const statusSpan = voiceBtn.querySelector('.voice-status');
        statusSpan.textContent = '录音中...';
        voiceBtn.style.backgroundColor = '#e74c3c';
      }
    </script>
  </body>
</html>
  